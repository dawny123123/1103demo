# è®¢å•ç®¡ç†æ“ä½œæµç¨‹

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [App.java](file://src/main/java/com/example/demo/App.java)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java)
- [Order.java](file://src/main/java/com/example/demo/entity/Order.java)
- [DBUtil.java](file://src/main/java/com/example/demo/dao/DBUtil.java)
- [OrderServiceTest.java](file://src/test/java/com/example/demo/service/OrderServiceTest.java)
- [pom.xml](file://pom.xml)
</cite>

## ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#æ ¸å¿ƒç»„ä»¶è¯¦è§£)
4. [è®¢å•ç®¡ç†æ“ä½œæµç¨‹](#è®¢å•ç®¡ç†æ“ä½œæµç¨‹)
5. [ä¸šåŠ¡è§„åˆ™ä¸å¼‚å¸¸å¤„ç†](#ä¸šåŠ¡è§„åˆ™ä¸å¼‚å¸¸å¤„ç†)
6. [æ•°æ®æŒä¹…åŒ–æœºåˆ¶](#æ•°æ®æŒä¹…åŒ–æœºåˆ¶)
7. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
8. [æœ€ä½³å®è·µå»ºè®®](#æœ€ä½³å®è·µå»ºè®®)

## ç³»ç»Ÿæ¦‚è¿°

æœ¬è®¢å•ç®¡ç†ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…å«ä¸‰ä¸ªä¸»è¦å±‚æ¬¡ï¼š
- **è¡¨ç°å±‚ï¼ˆApp.javaï¼‰**ï¼šæä¾›ä¸»ç¨‹åºå…¥å£å’Œç”¨æˆ·äº¤äº’æ¥å£
- **ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆOrderService.javaï¼‰**ï¼šå®ç°è®¢å•ä¸šåŠ¡è§„åˆ™å’Œæ§åˆ¶é€»è¾‘
- **æ•°æ®è®¿é—®å±‚ï¼ˆOrderDAO.javaï¼‰**ï¼šè´Ÿè´£æ•°æ®çš„å­˜å‚¨ã€æ£€ç´¢å’ŒæŒä¹…åŒ–

ç³»ç»Ÿæ”¯æŒå®Œæ•´çš„è®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œå¹¶å®ç°äº†ä¸¥æ ¼çš„ä¸šåŠ¡è§„åˆ™çº¦æŸã€‚

## æ¶æ„è®¾è®¡

```mermaid
graph TB
subgraph "è¡¨ç°å±‚"
App[App.java<br/>ä¸»ç¨‹åºå…¥å£]
end
subgraph "ä¸šåŠ¡é€»è¾‘å±‚"
OS[OrderService.java<br/>è®¢å•æœåŠ¡]
end
subgraph "æ•°æ®è®¿é—®å±‚"
ODAO[OrderDAO.java<br/>è®¢å•æ•°æ®è®¿é—®]
DBU[DBUtil.java<br/>æ•°æ®åº“å·¥å…·]
end
subgraph "æ•°æ®æ¨¡å‹"
Order[Order.java<br/>è®¢å•å®ä½“]
end
subgraph "å­˜å‚¨å±‚"
SQLite[(SQLiteæ•°æ®åº“<br/>test.db)]
end
App --> OS
OS --> ODAO
ODAO --> DBU
DBU --> SQLite
ODAO --> Order
OS -.-> Order
ODAO -.-> Order
```

**å›¾è¡¨æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L1-L62)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L1-L81)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L1-L148)
- [DBUtil.java](file://src/main/java/com/example/demo/dao/DBUtil.java#L1-L19)

**ç« èŠ‚æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L1-L62)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L1-L81)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L1-L148)

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### Orderå®ä½“ç±»

Orderå®ä½“ç±»å®šä¹‰äº†è®¢å•çš„æ ¸å¿ƒå±æ€§å’Œä¸šåŠ¡è§„åˆ™ï¼š

```mermaid
classDiagram
class Order {
-String orderId
-String userId
-String productId
-Integer quantity
-BigDecimal totalAmount
-Integer status
-LocalDateTime createTime
-LocalDateTime payTime
-LocalDateTime updateTime
+Order(orderId, userId, productId, quantity, totalAmount)
+Order(orderId, userId, productId, quantity, totalAmount, status, createTime, payTime, updateTime)
+getOrderId() String
+getQuantity() Integer
+getTotalAmount() BigDecimal
+getStatus() Integer
+setStatus(status) void
+toString() String
}
class OrderStatus {
<<enumeration>>
PENDING_PAYMENT : 0
PAID : 1
SHIPPED : 2
COMPLETED : 3
CANCELLED : 4
}
Order --> OrderStatus : uses
```

**å›¾è¡¨æ¥æº**
- [Order.java](file://src/main/java/com/example/demo/entity/Order.java#L1-L143)

### OrderServiceä¸šåŠ¡æœåŠ¡

OrderServiceè´Ÿè´£å®ç°ä¸šåŠ¡é€»è¾‘å’Œè§„åˆ™éªŒè¯ï¼š

```mermaid
classDiagram
class OrderService {
-OrderDAO orderDAO
+createOrder(order) boolean
+getOrder(orderId) Order
+updateOrder(order) boolean
+deleteOrder(orderId) boolean
#getOrderDAO() OrderDAO
}
class OrderDAO {
-Map~String,Order~ orderMap
+createOrder(order) boolean
+getOrder(orderId) Order
+updateOrder(order) boolean
+deleteOrder(orderId) boolean
+initTable() void
+saveToDatabase() void
}
OrderService --> OrderDAO : uses
```

**å›¾è¡¨æ¥æº**
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L1-L81)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L1-L148)

**ç« èŠ‚æ¥æº**
- [Order.java](file://src/main/java/com/example/demo/entity/Order.java#L1-L143)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L1-L81)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L1-L148)

## è®¢å•ç®¡ç†æ“ä½œæµç¨‹

### 1. åˆå§‹åŒ–æ•°æ®åº“è¿æ¥

```mermaid
sequenceDiagram
participant App as App.java
participant ODAO as OrderDAO
participant DBU as DBUtil
participant SQLite as SQLiteæ•°æ®åº“
App->>ODAO : new OrderDAO()
App->>ODAO : initTable()
ODAO->>DBU : getConnection()
DBU->>SQLite : å»ºç«‹è¿æ¥
SQLite-->>DBU : è¿æ¥å¥æŸ„
DBU-->>ODAO : Connection
ODAO->>SQLite : CREATE TABLE IF NOT EXISTS order0713
SQLite-->>ODAO : è¡¨åˆ›å»ºç»“æœ
ODAO-->>App : âœ… æ•°æ®åº“è¡¨åˆå§‹åŒ–å®Œæˆ
```

**å›¾è¡¨æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L12-L13)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L18-L32)
- [DBUtil.java](file://src/main/java/com/example/demo/dao/DBUtil.java#L14-L16)

**æ“ä½œæ­¥éª¤ï¼š**
1. åˆ›å»ºOrderDAOå®ä¾‹
2. è°ƒç”¨`initTable()`æ–¹æ³•åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„
3. é¢„æœŸè¾“å‡ºï¼š`âœ… æ•°æ®åº“è¡¨åˆå§‹åŒ–å®Œæˆ`

**æ•°æ®è¡¨ç»“æ„ï¼š**
| å­—æ®µå | ç±»å‹ | çº¦æŸ | æè¿° |
|--------|------|------|------|
| orderId | TEXT | PRIMARY KEY | è®¢å•å”¯ä¸€æ ‡è¯†ç¬¦ |
| userId | TEXT | - | ç”¨æˆ·ID |
| productId | TEXT | - | å•†å“ID |
| quantity | INTEGER | - | è´­ä¹°æ•°é‡ |
| totalAmount | TEXT | - | è®¢å•æ€»é‡‘é¢ï¼ˆå­—ç¬¦ä¸²å­˜å‚¨ï¼‰ |
| status | INTEGER | - | è®¢å•çŠ¶æ€ï¼ˆ0-å¾…æ”¯ä»˜, 1-å·²æ”¯ä»˜, 2-å·²å‘è´§, 3-å·²å®Œæˆ, 4-å·²å–æ¶ˆï¼‰ |
| createTime | TEXT | - | åˆ›å»ºæ—¶é—´ï¼ˆISOæ ¼å¼å­—ç¬¦ä¸²ï¼‰ |
| payTime | TEXT | - | æ”¯ä»˜æ—¶é—´ï¼ˆISOæ ¼å¼å­—ç¬¦ä¸²ï¼‰ |
| updateTime | TEXT | - | æ›´æ–°æ—¶é—´ï¼ˆISOæ ¼å¼å­—ç¬¦ä¸²ï¼‰ |

**ç« èŠ‚æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L12-L13)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L18-L32)

### 2. åˆ›å»ºè®¢å•

```mermaid
flowchart TD
Start([å¼€å§‹åˆ›å»ºè®¢å•]) --> ValidateParams["éªŒè¯è®¢å•å‚æ•°"]
ValidateParams --> CheckQuantity{"æ•°é‡ > 0?"}
CheckQuantity --> |å¦| ThrowException["æŠ›å‡ºIllegalArgumentException:<br/>è´­ä¹°æ•°é‡å¿…é¡»å¤§äº0"]
CheckQuantity --> |æ˜¯| CheckAmount{"é‡‘é¢ > 0?"}
CheckAmount --> |å¦| ThrowException2["æŠ›å‡ºIllegalArgumentException:<br/>è®¢å•é‡‘é¢å¿…é¡»å¤§äº0"]
CheckAmount --> |æ˜¯| CheckDuplicate{"è®¢å•IDå·²å­˜åœ¨?"}
CheckDuplicate --> |æ˜¯| ReturnFalse["è¿”å›false<br/>è®¢å•åˆ›å»ºå¤±è´¥"]
CheckDuplicate --> |å¦| AddToMemory["æ·»åŠ åˆ°å†…å­˜ç¼“å­˜<br/>orderMap.put()"]
AddToMemory --> ReturnTrue["è¿”å›true<br/>è®¢å•åˆ›å»ºæˆåŠŸ"]
ThrowException --> End([ç»“æŸ])
ThrowException2 --> End
ReturnFalse --> End
ReturnTrue --> End
```

**å›¾è¡¨æ¥æº**
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L15-L28)

**ä»£ç ç¤ºä¾‹è·¯å¾„ï¼š**
- [App.java](file://src/main/java/com/example/demo/App.java#L18-L25)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L15-L28)

**é¢„æœŸè¾“å‡ºï¼š**
- æˆåŠŸï¼š`âœ… è®¢å•åˆ›å»ºæˆåŠŸ`
- å¤±è´¥ï¼š`âŒ è®¢å•åˆ›å»ºå¤±è´¥`

**ä¸šåŠ¡æ ¡éªŒè§„åˆ™ï¼š**
1. **æ•°é‡æ ¡éªŒ**ï¼šè´­ä¹°æ•°é‡å¿…é¡»å¤§äº0
2. **é‡‘é¢æ ¡éªŒ**ï¼šè®¢å•æ€»é‡‘é¢å¿…é¡»å¤§äº0
3. **é‡å¤æ€§æ ¡éªŒ**ï¼šè®¢å•IDå¿…é¡»å”¯ä¸€

**ç« èŠ‚æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L18-L25)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L15-L28)

### 3. æ•°æ®æŒä¹…åŒ–åˆ°SQLite

```mermaid
sequenceDiagram
participant App as App.java
participant ODAO as OrderDAO
participant DBU as DBUtil
participant SQLite as SQLiteæ•°æ®åº“
App->>ODAO : saveToDatabase()
ODAO->>DBU : getConnection()
DBU->>SQLite : å»ºç«‹è¿æ¥
SQLite-->>DBU : è¿æ¥å¥æŸ„
DBU-->>ODAO : Connection
loop éå†æ‰€æœ‰è®¢å•
ODAO->>ODAO : æå–è®¢å•å­—æ®µå€¼
ODAO->>SQLite : INSERT OR REPLACE INTO order0713
Note over ODAO,SQLite : æ‰¹é‡æ’å…¥æ¨¡å¼
end
ODAO->>SQLite : æ‰§è¡Œæ‰¹é‡æ“ä½œ
SQLite-->>ODAO : æ“ä½œç»“æœ
ODAO-->>App : âœ… æ•°æ®å·²æŒä¹…åŒ–åˆ°SQLite
```

**å›¾è¡¨æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L27-L28)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L34-L72)
- [DBUtil.java](file://src/main/java/com/example/demo/dao/DBUtil.java#L14-L16)

**æ“ä½œæ­¥éª¤ï¼š**
1. è°ƒç”¨`saveToDatabase()`æ–¹æ³•
2. éå†å†…å­˜ä¸­çš„æ‰€æœ‰è®¢å•
3. ä½¿ç”¨`INSERT OR REPLACE`è¯­å¥è¿›è¡Œæ‰¹é‡å†™å…¥
4. é¢„æœŸè¾“å‡ºï¼š`âœ… æ•°æ®å·²æŒä¹…åŒ–åˆ°SQLite`

**æ•°æ®è½¬æ¢è§„åˆ™ï¼š**
- `LocalDateTime`ç±»å‹è½¬æ¢ä¸ºISOæ ¼å¼å­—ç¬¦ä¸²
- `BigDecimal`ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²å­˜å‚¨
- ç©ºå€¼ä¿æŒä¸ºNULL

**ç« èŠ‚æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L27-L28)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L34-L72)

### 4. æŸ¥è¯¢è®¢å•

```mermaid
flowchart TD
Start([å¼€å§‹æŸ¥è¯¢è®¢å•]) --> GetOrder["è°ƒç”¨getOrder(orderId)"]
GetOrder --> CheckExist{"è®¢å•æ˜¯å¦å­˜åœ¨?"}
CheckExist --> |å¦| ReturnNull["è¿”å›null<br/>è®¢å•ä¸å­˜åœ¨"]
CheckExist --> |æ˜¯| ReturnOrder["è¿”å›è®¢å•å¯¹è±¡<br/>è®¢å•å­˜åœ¨"]
ReturnNull --> End([ç»“æŸ])
ReturnOrder --> End
```

**å›¾è¡¨æ¥æº**
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L30-L33)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L104-L107)

**ä»£ç ç¤ºä¾‹è·¯å¾„ï¼š**
- [App.java](file://src/main/java/com/example/demo/App.java#L30-L31)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L30-L33)

**é¢„æœŸè¾“å‡ºï¼š**
- å­˜åœ¨ï¼š`ğŸ” æŸ¥è¯¢ç»“æœ: Order{orderId='O001', userId='U100', productId='P200', quantity=2, totalAmount=99.99, status=0, createTime=..., payTime=null, updateTime=null}`
- ä¸å­˜åœ¨ï¼š`ğŸ” æŸ¥è¯¢ç»“æœ: æœªæ‰¾åˆ°`

**ç« èŠ‚æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L30-L31)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L30-L33)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L104-L107)

### 5. æ›´æ–°è®¢å•çŠ¶æ€

```mermaid
flowchart TD
Start([å¼€å§‹æ›´æ–°è®¢å•]) --> CheckStatus{"æ£€æŸ¥æ–°çŠ¶æ€"}
CheckStatus --> |å·²å®Œæˆ(3)| GetExisting["è·å–ç°æœ‰è®¢å•"]
CheckStatus --> |å…¶ä»–çŠ¶æ€| DirectUpdate["ç›´æ¥è°ƒç”¨DAO.updateOrder()"]
GetExisting --> CompareStatus{"ç°æœ‰çŠ¶æ€æ˜¯å¦ä¸ºå·²å®Œæˆ?"}
CompareStatus --> |æ˜¯| ReturnFalse["è¿”å›false<br/>å·²å®Œæˆè®¢å•ä¸å¯ä¿®æ”¹"]
CompareStatus --> |å¦| CallDAO["è°ƒç”¨DAO.updateOrder()"]
DirectUpdate --> CallDAO
CallDAO --> CheckResult{"æ›´æ–°ç»“æœ"}
CheckResult --> |æˆåŠŸ| ReturnTrue["è¿”å›true<br/>æ›´æ–°æˆåŠŸ"]
CheckResult --> |å¤±è´¥| ReturnFalse2["è¿”å›false<br/>æ›´æ–°å¤±è´¥"]
ReturnFalse --> End([ç»“æŸ])
ReturnTrue --> End
ReturnFalse2 --> End
```

**å›¾è¡¨æ¥æº**
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L46-L62)

**ä»£ç ç¤ºä¾‹è·¯å¾„ï¼š**
- [App.java](file://src/main/java/com/example/demo/App.java#L34-L38)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L46-L62)

**ä¸šåŠ¡è§„åˆ™ï¼š**
1. **å·²å®Œæˆè®¢å•ä¿æŠ¤**ï¼šçŠ¶æ€ä¸º3ï¼ˆå·²å®Œæˆï¼‰çš„è®¢å•ä¸å¯ä¿®æ”¹
2. **çŠ¶æ€å˜æ›´éªŒè¯**ï¼šåªæœ‰çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶æ‰è¿›è¡Œæ£€æŸ¥
3. **æ”¯ä»˜çŠ¶æ€é™åˆ¶**ï¼šå·²æ”¯ä»˜ï¼ˆçŠ¶æ€1ï¼‰çš„è®¢å•å¯ä»¥æ­£å¸¸æ›´æ–°

**é¢„æœŸè¾“å‡ºï¼š**
- æˆåŠŸï¼š`âœ… è®¢å•æ›´æ–°æˆåŠŸ`
- å¤±è´¥ï¼š`âŒ è®¢å•æ›´æ–°å¤±è´¥`

**ç« èŠ‚æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L34-L38)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L46-L62)

### 6. åˆ é™¤è®¢å•

```mermaid
flowchart TD
Start([å¼€å§‹åˆ é™¤è®¢å•]) --> GetOrder["è·å–è®¢å•ä¿¡æ¯"]
GetOrder --> CheckExist{"è®¢å•æ˜¯å¦å­˜åœ¨?"}
CheckExist --> |å¦| ReturnFalse["è¿”å›false<br/>è®¢å•ä¸å­˜åœ¨"]
CheckExist --> |æ˜¯| CheckPayment{"æ£€æŸ¥æ”¯ä»˜çŠ¶æ€"}
CheckPayment --> IsPaid{"æ˜¯å¦å·²æ”¯ä»˜(çŠ¶æ€1)?"}
IsPaid --> |æ˜¯| ReturnFalse2["è¿”å›false<br/>å·²æ”¯ä»˜è®¢å•ä¸å¯åˆ é™¤"]
IsPaid --> |å¦| CallDAO["è°ƒç”¨DAO.deleteOrder()"]
CallDAO --> CheckResult{"åˆ é™¤ç»“æœ"}
CheckResult --> |æˆåŠŸ| ReturnTrue["è¿”å›true<br/>åˆ é™¤æˆåŠŸ"]
CheckResult --> |å¤±è´¥| ReturnFalse3["è¿”å›false<br/>åˆ é™¤å¤±è´¥"]
ReturnFalse --> End([ç»“æŸ])
ReturnFalse2 --> End
ReturnTrue --> End
ReturnFalse3 --> End
```

**å›¾è¡¨æ¥æº**
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L64-L76)

**ä»£ç ç¤ºä¾‹è·¯å¾„ï¼š**
- [App.java](file://src/main/java/com/example/demo/App.java#L40-L42)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L64-L76)

**ä¸šåŠ¡è§„åˆ™ï¼š**
1. **æ”¯ä»˜ä¿æŠ¤**ï¼šçŠ¶æ€ä¸º1ï¼ˆå·²æ”¯ä»˜ï¼‰çš„è®¢å•ä¸å¯åˆ é™¤
2. **å­˜åœ¨æ€§æ£€æŸ¥**ï¼šä¸å­˜åœ¨çš„è®¢å•æ— æ³•åˆ é™¤
3. **çº§è”åˆ é™¤**ï¼šåˆ é™¤æ“ä½œä»…å½±å“å½“å‰è®¢å•

**é¢„æœŸè¾“å‡ºï¼š**
- æˆåŠŸï¼š`âœ… è®¢å•åˆ é™¤æˆåŠŸ`
- å¤±è´¥ï¼š`âŒ è®¢å•åˆ é™¤å¤±è´¥`

**ç« èŠ‚æ¥æº**
- [App.java](file://src/main/java/com/example/demo/App.java#L40-L42)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L64-L76)

## ä¸šåŠ¡è§„åˆ™ä¸å¼‚å¸¸å¤„ç†

### å¼‚å¸¸å¤„ç†æœºåˆ¶

ç³»ç»Ÿå®ç°äº†å¤šå±‚æ¬¡çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼š

```mermaid
graph TD
subgraph "ä¸šåŠ¡å±‚å¼‚å¸¸"
B1[IllegalArgumentException<br/>æ•°é‡/é‡‘é¢æ ¡éªŒå¤±è´¥]
B2[ä¸šåŠ¡è§„åˆ™è¿å<br/>å·²å®Œæˆè®¢å•ä¿æŠ¤]
end
subgraph "æ•°æ®è®¿é—®å±‚å¼‚å¸¸"
D1[SQLException<br/>æ•°æ®åº“æ“ä½œå¤±è´¥]
D2[è¿æ¥å¼‚å¸¸<br/>æ•°æ®åº“è¿æ¥å¤±è´¥]
end
subgraph "å¼‚å¸¸å¤„ç†ç­–ç•¥"
E1[å‚æ•°æ ¡éªŒå¼‚å¸¸]
E2[ä¸šåŠ¡è§„åˆ™å¼‚å¸¸]
E3[æ•°æ®æŒä¹…åŒ–å¼‚å¸¸]
end
B1 --> E1
B2 --> E2
D1 --> E3
D2 --> E3
```

**å›¾è¡¨æ¥æº**
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L17-L22)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L18-L32)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L74-L87)

### ä¸šåŠ¡è§„åˆ™éªŒè¯è¡¨

| è§„åˆ™ç±»å‹ | éªŒè¯æ¡ä»¶ | å¼‚å¸¸ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|----------|----------|----------|----------|
| æ•°é‡æ ¡éªŒ | quantity <= 0 | "è´­ä¹°æ•°é‡å¿…é¡»å¤§äº0" | æŠ›å‡ºIllegalArgumentException |
| é‡‘é¢æ ¡éªŒ | totalAmount <= 0 | "è®¢å•é‡‘é¢å¿…é¡»å¤§äº0" | æŠ›å‡ºIllegalArgumentException |
| é‡å¤åˆ›å»º | orderIdå·²å­˜åœ¨ | - | è¿”å›falseï¼Œä¸æŠ›å¼‚å¸¸ |
| çŠ¶æ€ä¿æŠ¤ | å·²å®Œæˆè®¢å•ä¿®æ”¹ | - | è¿”å›falseï¼Œä¸æŠ›å¼‚å¸¸ |
| åˆ é™¤ä¿æŠ¤ | å·²æ”¯ä»˜è®¢å•åˆ é™¤ | - | è¿”å›falseï¼Œä¸æŠ›å¼‚å¸¸ |

**ç« èŠ‚æ¥æº**
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L17-L22)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L46-L62)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L64-L76)

## æ•°æ®æŒä¹…åŒ–æœºåˆ¶

### å†…å­˜ç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥

ç³»ç»Ÿé‡‡ç”¨å†…å­˜ç¼“å­˜+æ•°æ®åº“æŒä¹…åŒ–çš„åŒé‡å­˜å‚¨ç­–ç•¥ï¼š

```mermaid
graph LR
subgraph "å†…å­˜å±‚"
MC[å†…å­˜ç¼“å­˜<br/>ConcurrentHashMap]
end
subgraph "æŒä¹…åŒ–å±‚"
DB[(SQLiteæ•°æ®åº“<br/>test.db)]
end
subgraph "æ“ä½œæµç¨‹"
OP[ä¸šåŠ¡æ“ä½œ] --> MC
MC --> |saveToDatabase()| DB
DB --> |loadFromDatabase()| MC
end
MC -.->|create/update/delete| MC
MC -.->|saveToDatabase()| DB
```

**å›¾è¡¨æ¥æº**
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L14-L16)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L34-L72)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L89-L102)

### æ•°æ®è½¬æ¢ä¸å­˜å‚¨æ ¼å¼

| Javaç±»å‹ | å­˜å‚¨æ ¼å¼ | è½¬æ¢æ–¹å¼ | æ³¨æ„äº‹é¡¹ |
|----------|----------|----------|----------|
| LocalDateTime | ISOæ ¼å¼å­—ç¬¦ä¸² | `toString()` | ä¿æŒæ—¶åŒºä¿¡æ¯ |
| BigDecimal | å­—ç¬¦ä¸² | `toString()` | é¿å…ç²¾åº¦ä¸¢å¤± |
| Integer | æ•´æ•° | ç›´æ¥å­˜å‚¨ | æ ‡å‡†SQLç±»å‹ |
| String | æ–‡æœ¬ | ç›´æ¥å­˜å‚¨ | æœ€å¤§é•¿åº¦é™åˆ¶ |

**ç« èŠ‚æ¥æº**
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L34-L72)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L89-L102)

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šåˆ›å»ºé‡å¤è®¢å•å¤±è´¥

**ç—‡çŠ¶**ï¼š`âŒ è®¢å•åˆ›å»ºå¤±è´¥`

**åŸå› åˆ†æ**ï¼š
- è®¢å•IDå·²ç»å­˜åœ¨äºç³»ç»Ÿä¸­
- `createOrder()`æ–¹æ³•æ£€æµ‹åˆ°é‡å¤ID

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// æ£€æŸ¥è®¢å•æ˜¯å¦å­˜åœ¨
Order existingOrder = orderService.getOrder("O001");
if (existingOrder == null) {
    // åˆ›å»ºæ–°è®¢å•
    boolean created = orderService.createOrder(newOrder);
} else {
    // å¤„ç†é‡å¤è®¢å•æƒ…å†µ
    System.out.println("è®¢å•å·²å­˜åœ¨: " + existingOrder.toString());
}
```

**é¢„é˜²æªæ–½**ï¼š
- ä½¿ç”¨UUIDç”Ÿæˆå”¯ä¸€è®¢å•ID
- åœ¨åˆ›å»ºå‰æ£€æŸ¥è®¢å•æ˜¯å¦å­˜åœ¨

### é—®é¢˜2ï¼šæ›´æ–°å·²å®Œæˆè®¢å•å¤±è´¥

**ç—‡çŠ¶**ï¼š`âŒ è®¢å•æ›´æ–°å¤±è´¥`

**åŸå› åˆ†æ**ï¼š
- å°è¯•ä¿®æ”¹çŠ¶æ€ä¸º3ï¼ˆå·²å®Œæˆï¼‰çš„è®¢å•
- ç³»ç»Ÿé˜»æ­¢å·²å®Œæˆè®¢å•çš„ä¿®æ”¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// æ£€æŸ¥è®¢å•çŠ¶æ€
Order order = orderService.getOrder("O001");
if (order != null && order.getStatus() == 3) {
    System.out.println("å·²å®Œæˆè®¢å•ä¸å¯ä¿®æ”¹");
} else {
    // æ‰§è¡Œæ›´æ–°æ“ä½œ
    order.setStatus(2); // ä¿®æ”¹ä¸ºå·²å‘è´§
    orderService.updateOrder(order);
}
```

### é—®é¢˜3ï¼šåˆ é™¤å·²æ”¯ä»˜è®¢å•å¤±è´¥

**ç—‡çŠ¶**ï¼š`âŒ è®¢å•åˆ é™¤å¤±è´¥`

**åŸå› åˆ†æ**ï¼š
- è®¢å•çŠ¶æ€ä¸º1ï¼ˆå·²æ”¯ä»˜ï¼‰
- ç³»ç»Ÿä¿æŠ¤å·²æ”¯ä»˜è®¢å•ä¸è¢«åˆ é™¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// æ£€æŸ¥è®¢å•æ”¯ä»˜çŠ¶æ€
Order order = orderService.getOrder("O001");
if (order != null && order.getStatus() == 1) {
    System.out.println("å·²æ”¯ä»˜è®¢å•ä¸èƒ½åˆ é™¤ï¼Œè¯·å…ˆå–æ¶ˆæ”¯ä»˜");
} else {
    // æ‰§è¡Œåˆ é™¤æ“ä½œ
    orderService.deleteOrder("O001");
}
```

### é—®é¢˜4ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼š`æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥: ...`

**åŸå› åˆ†æ**ï¼š
- SQLiteé©±åŠ¨æœªæ­£ç¡®é…ç½®
- æ•°æ®åº“æ–‡ä»¶è·¯å¾„é”™è¯¯
- æƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥pom.xmlä¸­çš„ä¾èµ–é…ç½®
2. éªŒè¯æ•°æ®åº“æ–‡ä»¶è·¯å¾„
3. ç¡®ä¿æœ‰æ–‡ä»¶å†™å…¥æƒé™

**ç« èŠ‚æ¥æº**
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L46-L62)
- [OrderService.java](file://src/main/java/com/example/demo/service/OrderService.java#L64-L76)
- [OrderDAO.java](file://src/main/java/com/example/demo/dao/OrderDAO.java#L18-L32)

## æœ€ä½³å®è·µå»ºè®®

### 1. è®¢å•IDç”Ÿæˆç­–ç•¥
- ä½¿ç”¨UUIDç¡®ä¿å”¯ä¸€æ€§
- è€ƒè™‘ä¸šåŠ¡å«ä¹‰çš„å‰ç¼€ç¼–ç 
- å®ç°å¹‚ç­‰æ€§æ£€æŸ¥

### 2. å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ
```java
try {
    boolean result = orderService.createOrder(order);
    if (!result) {
        // å¤„ç†è®¢å•å·²å­˜åœ¨çš„æƒ…å†µ
        handleDuplicateOrder(order.getOrderId());
    }
} catch (IllegalArgumentException ex) {
    // å¤„ç†ä¸šåŠ¡å‚æ•°å¼‚å¸¸
    handleBusinessValidationException(ex);
}
```

### 3. æ•°æ®ä¸€è‡´æ€§ä¿è¯
- ä½¿ç”¨äº‹åŠ¡æœºåˆ¶ç¡®ä¿æ“ä½œåŸå­æ€§
- å®ç°ä¹è§‚é”é˜²æ­¢å¹¶å‘å†²çª
- å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶

### 4. æ€§èƒ½ä¼˜åŒ–å»ºè®®
- åˆç†ä½¿ç”¨å†…å­˜ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®
- æ‰¹é‡æ“ä½œæé«˜æ€§èƒ½
- å®ç°é€‚å½“çš„ç´¢å¼•ç­–ç•¥

### 5. ç›‘æ§ä¸æ—¥å¿—
- è®°å½•å…³é”®æ“ä½œçš„æ—¥å¿—
- ç›‘æ§å¼‚å¸¸å‘ç”Ÿé¢‘ç‡
- å®ç°å¥åº·æ£€æŸ¥æœºåˆ¶

é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªç¨³å®šã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„è®¢å•ç®¡ç†ç³»ç»Ÿã€‚