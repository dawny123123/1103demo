# 环境配置

<cite>
**本文档中引用的文件**  
- [pom.xml](file://pom.xml)
- [myenv/pyvenv.cfg](file://myenv/pyvenv.cfg)
- [README.md](file://README.md)
- [src/main/java/com/example/demo/App.java](file://src/main/java/com/example/demo/App.java)
- [markitdown_mcp_example.py](file://markitdown_mcp_example.py)
- [comprehensive_excel_analysis.py](file://comprehensive_excel_analysis.py)
- [start-mcp-server.sh](file://start-mcp-server.sh)
</cite>

## 目录
1. [简介](#简介)
2. [前置软件要求](#前置软件要求)
3. [Java环境配置](#java环境配置)
4. [Python环境配置](#python环境配置)
5. [跨平台环境差异说明](#跨平台环境差异说明)
6. [构建与运行命令](#构建与运行命令)
7. [常见环境问题排查](#常见环境问题排查)
8. [验证环境配置](#验证环境配置)
9. [总结](#总结)

## 简介
本文档提供详细的开发环境搭建指南，涵盖Java和Python两种技术栈的配置方法。基于项目中的`pom.xml`和Python脚本，指导开发者正确配置Maven项目、创建Python虚拟环境，并安装必要的依赖包。同时提供跨平台（Windows/macOS/Linux）的配置差异说明和常见问题解决方案。

## 前置软件要求
在开始配置开发环境之前，请确保系统已安装以下软件：

- **Java Development Kit (JDK) 8或更高版本**：用于编译和运行Java应用程序
- **Python 3.8或更高版本**：用于执行Python脚本和数据分析任务
- **Apache Maven 3.6或更高版本**：用于Java项目的依赖管理和构建
- **pip包管理工具**：用于安装Python依赖包
- **Git（可选）**：用于版本控制和代码获取

**验证方法**：
- 检查Java版本：`java -version`
- 检查Javac版本：`javac -version`
- 检查Python版本：`python --version` 或 `python3 --version`
- 检查Maven版本：`mvn -v`
- 检查pip版本：`pip --version`

**Section sources**
- [pom.xml](file://pom.xml)
- [README.md](file://README.md)

## Java环境配置
### Maven项目配置
本项目使用Maven进行依赖管理和构建，核心配置文件为`pom.xml`。

1. **JDK版本要求**：项目要求JDK 8或更高版本。`pom.xml`中已配置编译器插件指定Java版本。

2. **依赖下载**：
   - 将`pom.xml`文件放置在项目根目录
   - Maven会自动读取该文件并下载声明的依赖项
   - 依赖项包括JUnit测试框架、数据库连接库等

3. **本地仓库配置**：
   - Maven默认在用户主目录下创建`.m2`文件夹作为本地仓库
   - 可通过`settings.xml`文件自定义仓库位置和镜像源

**Section sources**
- [pom.xml](file://pom.xml)
- [src/main/java/com/example/demo/App.java](file://src/main/java/com/example/demo/App.java)

## Python环境配置
### 虚拟环境创建与激活
项目包含预配置的Python虚拟环境`myenv`，基于`pyvenv.cfg`文件创建。

1. **虚拟环境创建**：
   ```bash
   python -m venv myenv
   ```
   或
   ```bash
   python3 -m venv myenv
   ```

2. **虚拟环境激活**：
   - **Linux/macOS (bash/zsh)**：
     ```bash
     source myenv/bin/activate
     ```
   - **Linux/macOS (csh/tcsh)**：
     ```bash
     source myenv/bin/activate.csh
     ```
   - **Windows (Command Prompt)**：
     ```cmd
     myenv\Scripts\activate.bat
     ```
   - **Windows (PowerShell)**：
     ```powershell
     myenv\Scripts\Activate.ps1
     ```

3. **必要包安装**：
   激活虚拟环境后，安装项目所需的Python包：
   ```bash
   pip install pandas markitdown openpyxl xlrd
   ```
   
   项目中的Python脚本（如`comprehensive_excel_analysis.py`）依赖pandas进行数据分析，markitdown用于Markdown处理。

**Section sources**
- [myenv/pyvenv.cfg](file://myenv/pyvenv.cfg)
- [comprehensive_excel_analysis.py](file://comprehensive_excel_analysis.py)
- [markitdown_mcp_example.py](file://markitdown_mcp_example.py)

## 跨平台环境差异说明
### Windows系统
- 路径分隔符使用反斜杠`\`
- 虚拟环境激活脚本位于`myenv\Scripts\`目录下
- 可能需要管理员权限运行某些命令
- PowerShell中执行`Activate.ps1`可能受执行策略限制，需先运行：
  ```powershell
  Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
  ```

### macOS/Linux系统
- 路径分隔符使用正斜杠`/`
- 虚拟环境激活脚本位于`myenv/bin/`目录下
- 可能需要为脚本添加执行权限：
  ```bash
  chmod +x myenv/bin/activate*
  ```
- 在某些Linux发行版中，可能需要安装`python3-venv`包：
  ```bash
  sudo apt-get install python3-venv  # Ubuntu/Debian
  ```

### Shell差异
- **Bash/Zsh**：使用`activate`脚本
- **Csh/Tcsh**：使用`activate.csh`脚本
- **Fish**：使用`activate.fish`脚本（如存在）

**Section sources**
- [myenv/pyvenv.cfg](file://myenv/pyvenv.cfg)
- [myenv/bin/activate.csh](file://myenv/bin/activate.csh)
- [myenv/bin/Activate.ps1](file://myenv/bin/Activate.ps1)

## 构建与运行命令
### Java项目构建
使用Maven命令进行项目构建：

```bash
# 编译项目
mvn compile

# 运行单元测试
mvn test

# 打包项目（生成JAR文件）
mvn package

# 清理构建输出
mvn clean

# 编译并跳过测试
mvn compile -DskipTests
```

### Python脚本执行
```bash
# 激活虚拟环境后执行Excel分析脚本
python comprehensive_excel_analysis.py

# 执行Markitdown示例
python markitdown_mcp_example.py

# 创建示例Excel文件
python create_sample_excel.py
```

### 启动MCP服务器
```bash
# 给予执行权限
chmod +x start-mcp-server.sh

# 启动服务器
./start-mcp-server.sh
```

**Section sources**
- [pom.xml](file://pom.xml)
- [comprehensive_excel_analysis.py](file://comprehensive_excel_analysis.py)
- [markitdown_mcp_example.py](file://markitdown_mcp_example.py)
- [start-mcp-server.sh](file://start-mcp-server.sh)

## 常见环境问题排查
### 依赖包缺失
**症状**：导入模块时出现`ModuleNotFoundError`
**解决方案**：
1. 确认虚拟环境已激活
2. 检查`pip list`查看已安装包
3. 重新安装缺失的包：
   ```bash
   pip install pandas markitdown
   ```

### 版本冲突
**症状**：运行时出现兼容性错误
**解决方案**：
1. 使用虚拟环境隔离项目依赖
2. 检查`pyvenv.cfg`中的Python版本
3. 使用`pip check`检查依赖冲突
4. 创建新的虚拟环境并重新安装依赖

### 权限错误
**症状**：无法写入文件或执行脚本
**解决方案**：
- **Linux/macOS**：使用`chmod`修改文件权限
  ```bash
  chmod 755 myenv/bin/*
  ```
- **Windows**：以管理员身份运行命令提示符
- 避免在系统保护目录中创建虚拟环境

### Maven构建失败
**症状**：`mvn`命令无法执行或下载依赖失败
**解决方案**：
1. 检查Maven是否正确安装：`mvn -v`
2. 检查网络连接和代理设置
3. 清理本地仓库缓存：
   ```bash
   mvn dependency:purge-local-repository
   ```
4. 强制更新依赖：
   ```bash
   mvn clean install -U
   ```

### 编码问题
**症状**：处理中文文件时出现乱码
**解决方案**：
1. 确保Python脚本使用UTF-8编码
2. 在读取文件时指定编码：
   ```python
   pd.read_excel('file.xlsx', encoding='utf-8')
   ```
3. 设置系统区域设置为UTF-8

**Section sources**
- [pom.xml](file://pom.xml)
- [myenv/pyvenv.cfg](file://myenv/pyvenv.cfg)
- [comprehensive_excel_analysis.py](file://comprehensive_excel_analysis.py)

## 验证环境配置
完成环境配置后，执行以下步骤验证配置是否正确：

1. **Java环境验证**：
   ```bash
   mvn compile
   ```
   应成功编译`src/main/java`目录下的Java文件。

2. **测试执行验证**：
   ```bash
   mvn test
   ```
   应运行`src/test/java`目录下的测试用例，并生成报告到`target/surefire-reports/`目录。

3. **Python环境验证**：
   ```bash
   source myenv/bin/activate
   python -c "import pandas, markitdown; print('Python环境配置成功')"
   ```

4. **脚本执行验证**：
   ```bash
   python comprehensive_excel_analysis.py
   ```
   应成功执行Excel分析脚本。

5. **打包验证**：
   ```bash
   mvn package
   ```
   应在`target/`目录下生成JAR文件。

**Section sources**
- [pom.xml](file://pom.xml)
- [myenv/pyvenv.cfg](file://myenv/pyvenv.cfg)
- [comprehensive_excel_analysis.py](file://comprehensive_excel_analysis.py)

## 总结
本文档详细介绍了项目的开发环境配置流程，涵盖Java和Python两种技术栈。通过Maven管理Java依赖，使用Python虚拟环境隔离Python依赖，确保了项目的可移植性和环境一致性。配置过程中需注意跨平台差异，特别是路径分隔符、脚本激活方式和权限设置。遇到问题时，可参考排查指南逐步解决。正确的环境配置是项目成功运行的基础，建议严格按照文档步骤进行配置和验证。