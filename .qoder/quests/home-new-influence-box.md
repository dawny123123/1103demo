# 首页影响力模块设计文档

## 1. 需求概述

在系统首页新增"影响力"管理模块，用于记录和展示公司在市场、品牌、技术等方面的影响力活动与成果。

### 1.1 功能定位

影响力模块作为独立的业务功能区块，与现有的订单管理模块并列展示在首页，用于记录和管理各类影响力活动。

### 1.2 核心价值

- 集中管理公司各类影响力活动记录
- 支持多种活动类型的分类管理
- 提供完整的活动生命周期状态跟踪
- 支持图片等富媒体内容的记录

## 2. 数据模型设计

### 2.1 影响力实体属性

| 属性名称 | 数据类型 | 必填 | 说明 | 约束条件 |
|---------|---------|------|------|---------|
| id | String | 是 | 影响力记录唯一标识 | 主键，自动生成或手动输入 |
| name | String | 是 | 活动名称 | 长度限制1-200字符 |
| type | String | 是 | 活动类型 | 枚举值：SA培训、logo、案例、竞品分析、demo、大会分享 |
| status | String | 是 | 当前状态 | 枚举值：计划中、进行中、已完成、已取消 |
| eventTime | LocalDateTime | 是 | 活动时间 | 记录活动发生或计划的时间 |
| link | String | 否 | 相关链接 | URL格式，长度限制1-500字符 |
| remark | String | 否 | 备注说明 | 支持文本内容，长度限制1-2000字符 |
| imageUrls | List&lt;String&gt; | 否 | 图片URL列表 | 存储上传图片的访问路径 |
| createTime | LocalDateTime | 是 | 创建时间 | 系统自动生成 |
| updateTime | LocalDateTime | 否 | 更新时间 | 系统自动维护 |

### 2.2 活动类型定义

| 类型编码 | 类型名称 | 说明 |
|---------|---------|------|
| SA_TRAINING | SA培训 | 解决方案架构师培训活动 |
| LOGO | logo | 品牌logo相关的展示活动 |
| CASE_STUDY | 案例 | 客户成功案例或项目案例 |
| COMPETITOR_ANALYSIS | 竞品分析 | 市场竞品研究与分析 |
| DEMO | demo | 产品演示或技术展示 |
| CONFERENCE_SHARING | 大会分享 | 技术大会、行业峰会分享 |

### 2.3 状态定义

| 状态编码 | 状态名称 | 说明 |
|---------|---------|------|
| PLANNED | 计划中 | 活动尚在筹备阶段 |
| IN_PROGRESS | 进行中 | 活动正在进行 |
| COMPLETED | 已完成 | 活动已成功完成 |
| CANCELLED | 已取消 | 活动被取消 |

## 3. 系统架构设计

### 3.1 分层架构

采用与现有订单模块一致的三层架构模式：

```
┌─────────────────────────────────────┐
│         前端展示层 (React)            │
│  - 影响力列表展示                     │
│  - 影响力创建表单                     │
│  - 图片上传组件                       │
└─────────────────────────────────────┘
              ↓ HTTP/REST
┌─────────────────────────────────────┐
│    控制器层 (InfluenceController)    │
│  - 请求参数验证                       │
│  - 响应封装                          │
│  - 异常处理                          │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│    服务层 (InfluenceService)         │
│  - 业务逻辑处理                       │
│  - 数据校验                          │
│  - 图片处理逻辑                       │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│    数据访问层 (InfluenceDAO)          │
│  - CRUD操作                          │
│  - 内存缓存同步                       │
│  - 数据库持久化                       │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│      数据存储 (SQLite)                │
│  - influence 表                      │
└─────────────────────────────────────┘
```

### 3.2 组件交互流程

```
用户操作 → React组件 → API请求 → Controller → Service → DAO → 数据库
                                                ↓
                                          内存缓存 (ConcurrentHashMap)
```

## 4. 接口设计

### 4.1 RESTful API规范

#### 4.1.1 创建影响力记录

**请求**
- 方法: POST
- 路径: /api/influences
- 请求体示例:
```
{
  "id": "INF20250101001",
  "name": "Qoder产品SA培训",
  "type": "SA_TRAINING",
  "status": "PLANNED",
  "eventTime": "2025-01-15T14:00:00",
  "link": "https://example.com/training",
  "remark": "针对新加入的SA团队成员进行产品培训",
  "imageUrls": []
}
```

**响应**
```
{
  "success": true,
  "message": "影响力记录创建成功",
  "data": { 影响力记录对象 }
}
```

#### 4.1.2 查询所有影响力记录

**请求**
- 方法: GET
- 路径: /api/influences

**响应**
```
{
  "success": true,
  "message": "查询成功",
  "count": 10,
  "data": [ 影响力记录数组 ]
}
```

#### 4.1.3 按类型查询

**请求**
- 方法: GET
- 路径: /api/influences/type/{type}
- 路径参数: type (活动类型)

**响应**
```
{
  "success": true,
  "message": "查询成功",
  "count": 3,
  "data": [ 影响力记录数组 ]
}
```

#### 4.1.4 查询单个记录

**请求**
- 方法: GET
- 路径: /api/influences/{id}
- 路径参数: id (影响力记录ID)

**响应**
```
{
  "success": true,
  "message": "查询成功",
  "data": { 影响力记录对象 }
}
```

#### 4.1.5 更新影响力记录

**请求**
- 方法: PUT
- 路径: /api/influences/{id}
- 请求体: 完整的影响力记录对象

**响应**
```
{
  "success": true,
  "message": "更新成功",
  "data": { 更新后的影响力记录 }
}
```

#### 4.1.6 删除影响力记录

**请求**
- 方法: DELETE
- 路径: /api/influences/{id}

**响应**
```
{
  "success": true,
  "message": "删除成功"
}
```

#### 4.1.7 图片上传接口

**请求**
- 方法: POST
- 路径: /api/influences/upload
- Content-Type: multipart/form-data
- 请求体: 图片文件

**响应**
```
{
  "success": true,
  "message": "图片上传成功",
  "data": {
    "url": "上传后的图片访问URL"
  }
}
```

## 5. 数据库设计

### 5.1 表结构定义

**表名**: influence

| 字段名 | 数据类型 | 约束 | 说明 |
|-------|---------|------|------|
| id | TEXT | PRIMARY KEY | 影响力记录唯一标识 |
| name | TEXT | NOT NULL | 活动名称 |
| type | TEXT | NOT NULL | 活动类型 |
| status | TEXT | NOT NULL | 当前状态 |
| event_time | TEXT | NOT NULL | 活动时间(ISO格式) |
| link | TEXT | NULL | 相关链接 |
| remark | TEXT | NULL | 备注说明 |
| image_urls | TEXT | NULL | 图片URL列表(JSON数组格式存储) |
| create_time | TEXT | NOT NULL | 创建时间(ISO格式) |
| update_time | TEXT | NULL | 更新时间(ISO格式) |

### 5.2 数据持久化策略

参考现有订单模块的实现模式：

1. **内存优先**: 使用 ConcurrentHashMap 作为内存缓存
2. **双写机制**: 内存操作成功后同步写入数据库
3. **启动加载**: 应用启动时从数据库加载数据到内存
4. **事务保证**: 关键操作确保内存与数据库的一致性

## 6. 业务逻辑设计

### 6.1 创建影响力记录

**业务规则**:
- id 必须唯一，若已存在则创建失败
- name、type、status、eventTime 为必填字段
- type 必须是预定义的6种类型之一
- status 必须是预定义的4种状态之一
- link 若填写必须符合URL格式规范
- createTime 由系统自动设置为当前时间
- imageUrls 默认为空数组

**处理流程**:
1. 验证请求参数的完整性和有效性
2. 检查 id 是否已存在
3. 验证 type 和 status 的枚举值
4. 验证 link 的URL格式（如果提供）
5. 设置 createTime
6. 保存到内存缓存
7. 持久化到数据库
8. 返回成功响应

### 6.2 查询影响力记录

**按类型查询业务规则**:
- type 参数必须是有效的枚举值
- 返回结果按 eventTime 降序排列（最新的在前）
- 若该类型无记录，返回空数组

**全量查询业务规则**:
- 返回所有记录
- 按 eventTime 降序排列
- 支持分页（可选，若数据量大）

### 6.3 更新影响力记录

**业务规则**:
- id 必须存在，否则更新失败
- 不允许修改 id 和 createTime
- updateTime 自动设置为当前时间
- 其他字段遵循创建时的验证规则

**处理流程**:
1. 验证 id 是否存在
2. 验证更新字段的有效性
3. 保护 id 和 createTime 不被修改
4. 设置 updateTime
5. 更新内存缓存
6. 持久化到数据库
7. 返回更新后的记录

### 6.4 删除影响力记录

**业务规则**:
- id 必须存在，否则删除失败
- 删除操作不可逆，需要前端确认
- 删除记录时同时删除关联的图片文件（可选）

**处理流程**:
1. 验证 id 是否存在
2. 从内存缓存中移除
3. 从数据库中删除
4. 清理关联的图片文件（可选）
5. 返回删除成功响应

### 6.5 图片上传处理

**业务规则**:
- 支持的图片格式: jpg, jpeg, png, gif
- 单个图片大小限制: 5MB
- 单条记录最多支持10张图片
- 图片文件名使用UUID生成，避免冲突

**处理流程**:
1. 验证文件类型和大小
2. 生成唯一的文件名
3. 保存文件到指定目录
4. 返回访问URL
5. 前端将URL添加到 imageUrls 数组中

## 7. 前端界面设计

### 7.1 页面布局

在首页增加独立的"影响力管理"区块，与"订单管理"区块并列展示。

**布局结构**:
```
┌─────────────────────────────────────────────┐
│          首页标题                             │
├─────────────────────────────────────────────┤
│  [订单管理区块]                               │
│  - 创建订单表单                               │
│  - 订单列表展示                               │
├─────────────────────────────────────────────┤
│  [影响力管理区块]  ← 新增                     │
│  - 创建影响力记录表单                          │
│  - 影响力记录列表展示                          │
└─────────────────────────────────────────────┘
```

### 7.2 创建表单设计

**表单字段布局**:

| 字段 | 组件类型 | 说明 |
|------|---------|------|
| ID | 文本输入框 | 必填，占位符提示格式 |
| 名称 | 文本输入框 | 必填，最大200字符 |
| 类型 | 下拉选择框 | 必填，6种类型选项 |
| 状态 | 下拉选择框 | 必填，4种状态选项，默认"计划中" |
| 活动时间 | 日期时间选择器 | 必填，支持选择日期和时间 |
| 链接 | 文本输入框 | 可选，URL格式提示 |
| 备注 | 多行文本框 | 可选，支持2000字符 |
| 图片上传 | 文件上传组件 | 可选，支持多图上传，最多10张 |

**表单操作按钮**:
- 提交创建按钮
- 重置表单按钮

### 7.3 列表展示设计

**表格列定义**:

| 列名 | 说明 | 宽度建议 |
|------|------|---------|
| ID | 记录ID | 10% |
| 名称 | 活动名称 | 20% |
| 类型 | 活动类型（中文显示） | 10% |
| 状态 | 当前状态（带颜色标识） | 8% |
| 活动时间 | 格式化的日期时间 | 12% |
| 链接 | 显示为可点击链接 | 10% |
| 备注 | 显示前50字符 | 15% |
| 操作 | 查看、编辑、删除按钮 | 15% |

**状态颜色标识**:
- 计划中: 蓝色
- 进行中: 橙色
- 已完成: 绿色
- 已取消: 灰色

**列表功能**:
- 按类型筛选
- 按状态筛选
- 搜索功能（按名称）
- 分页展示

### 7.4 图片上传组件

**组件功能**:
- 支持拖拽上传和点击选择
- 实时预览已上传的图片
- 显示上传进度
- 支持删除已上传的图片
- 图片数量和大小限制提示

## 8. 异常处理设计

### 8.1 业务异常

| 异常场景 | HTTP状态码 | 错误信息 |
|---------|-----------|---------|
| ID已存在 | 400 | "影响力记录ID已存在" |
| ID不存在 | 404 | "影响力记录不存在" |
| 必填字段缺失 | 400 | "缺少必填字段: {字段名}" |
| 类型枚举值无效 | 400 | "无效的活动类型" |
| 状态枚举值无效 | 400 | "无效的状态值" |
| URL格式错误 | 400 | "链接格式不正确" |
| 图片格式不支持 | 400 | "不支持的图片格式" |
| 图片大小超限 | 400 | "图片大小不能超过5MB" |
| 图片数量超限 | 400 | "最多支持上传10张图片" |

### 8.2 系统异常

| 异常场景 | HTTP状态码 | 处理策略 |
|---------|-----------|---------|
| 数据库连接失败 | 500 | 返回友好提示，记录日志 |
| 文件上传失败 | 500 | 返回错误信息，清理临时文件 |
| 内存缓存同步失败 | 500 | 记录日志，触发告警 |

## 9. 数据验证规则

### 9.1 字段级验证

| 字段 | 验证规则 |
|------|---------|
| id | 非空，长度1-50字符，允许字母数字下划线 |
| name | 非空，长度1-200字符 |
| type | 非空，必须是枚举值之一 |
| status | 非空，必须是枚举值之一 |
| eventTime | 非空，有效的日期时间格式 |
| link | 可空，若非空则验证URL格式 |
| remark | 可空，最大长度2000字符 |
| imageUrls | 可空，每个URL验证格式，数组最大10个元素 |

### 9.2 业务级验证

- 创建时确保 id 唯一性
- 更新时确保记录存在
- 删除时确保记录存在
- 图片上传时验证文件类型和大小

## 10. 性能优化建议

### 10.1 数据访问优化

- 使用内存缓存减少数据库访问
- 查询结果按需排序和筛选
- 大数据量场景考虑分页加载

### 10.2 图片处理优化

- 图片上传后生成缩略图
- 前端显示时使用懒加载
- 考虑使用CDN存储图片

### 10.3 前端优化

- 表单输入实时验证
- 图片上传显示进度条
- 列表数据虚拟滚动（数据量大时）

## 11. 安全性考虑

### 11.1 数据安全

- 输入参数进行XSS防护
- URL参数进行编码处理
- 文件上传防止路径穿越攻击

### 11.2 权限控制

- API接口增加认证机制（可选）
- 敏感操作需要二次确认
- 操作日志记录（可选）

## 12. 扩展性设计

### 12.1 预留扩展点

- 活动类型可通过配置文件扩展
- 状态流转可配置化
- 支持自定义字段扩展
- 支持附件类型扩展（如PDF、视频等）

### 12.2 未来功能预留

- 影响力统计报表
- 按时间线展示
- 导出功能（Excel、PDF）
- 数据可视化展示
